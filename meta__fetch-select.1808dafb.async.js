"use strict";(self.webpackChunk_trionesdev_antd_react_ext=self.webpackChunk_trionesdev_antd_react_ext||[]).push([[7007],{69327:function(a,n,e){var r;e.r(n),e.d(n,{demos:function(){return P}});var R=e(15009),s=e.n(R),O=e(99289),v=e.n(O),o=e(67294),d=e(801),c=e(28061),_=e(88600),y=e(65567),i=e(59811),u=e(69702),F=e(71354),m=e(52149),x=e(14406),P={"fetch-select-demo-base":{component:o.memo(o.lazy(function(){return e.e(5494).then(e.bind(e,44661))})),asset:{type:"BLOCK",id:"fetch-select-demo-base",refAtomIds:["fetch-select"],dependencies:{"index.tsx":{type:"FILE",value:e(44750).Z},react:{type:"NPM",value:"18.3.1"},"../index.tsx":{type:"FILE",value:e(81867).Z},"./fetch-select.tsx":{type:"FILE",value:e(75415).Z},"lodash-es":{type:"NPM",value:"4.17.21"},"@trionesdev/antd-react-ext":{type:"NPM",value:"6.0.0-beta.0"},"../ext-select.tsx":{type:"FILE",value:e(79458).Z},"./ExtSelect.tsx":{type:"FILE",value:e(6721).Z},antd:{type:"NPM",value:"6.1.0"},"../ext-form-field.tsx":{type:"FILE",value:e(94291).Z},"./ExtFormField.tsx":{type:"FILE",value:e(72421).Z}},entry:"index.tsx"},context:{"../index.tsx":d,"./fetch-select.tsx":c,"../ext-select.tsx":i,"./ExtSelect.tsx":u,"../ext-form-field.tsx":m,"./ExtFormField.tsx":x,react:r||(r=e.t(o,2)),"/home/runner/work/antd-react-ext/antd-react-ext/src/fetch-select/index.tsx":d,"/home/runner/work/antd-react-ext/antd-react-ext/src/fetch-select/fetch-select.tsx":c,"lodash-es":_,"@trionesdev/antd-react-ext":y,"/home/runner/work/antd-react-ext/antd-react-ext/src/ext-select/index.tsx":i,"/home/runner/work/antd-react-ext/antd-react-ext/src/ext-select/ExtSelect.tsx":u,antd:F,"/home/runner/work/antd-react-ext/antd-react-ext/src/ext-form-field/index.tsx":m,"/home/runner/work/antd-react-ext/antd-react-ext/src/ext-form-field/ExtFormField.tsx":x},renderOpts:{compile:function(){var p=v()(s()().mark(function h(){var l,E=arguments;return s()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.e(250).then(e.bind(e,90250));case 2:return t.abrupt("return",(l=t.sent).default.apply(l,E));case 3:case"end":return t.stop()}},h)}));function f(){return p.apply(this,arguments)}return f}()}},"fetch-select-demo-set-initial-option":{component:o.memo(o.lazy(function(){return e.e(5494).then(e.bind(e,29400))})),asset:{type:"BLOCK",id:"fetch-select-demo-set-initial-option",refAtomIds:["fetch-select"],dependencies:{"index.tsx":{type:"FILE",value:e(8841).Z},antd:{type:"NPM",value:"6.1.0"},react:{type:"NPM",value:"18.3.1"},"../index.tsx":{type:"FILE",value:e(81867).Z},"./fetch-select.tsx":{type:"FILE",value:e(75415).Z},"lodash-es":{type:"NPM",value:"4.17.21"},"@trionesdev/antd-react-ext":{type:"NPM",value:"6.0.0-beta.0"},"../ext-select.tsx":{type:"FILE",value:e(79458).Z},"./ExtSelect.tsx":{type:"FILE",value:e(6721).Z},"../ext-form-field.tsx":{type:"FILE",value:e(94291).Z},"./ExtFormField.tsx":{type:"FILE",value:e(72421).Z}},entry:"index.tsx"},context:{"../index.tsx":d,"./fetch-select.tsx":c,"../ext-select.tsx":i,"./ExtSelect.tsx":u,"../ext-form-field.tsx":m,"./ExtFormField.tsx":x,antd:F,react:r||(r=e.t(o,2)),"/home/runner/work/antd-react-ext/antd-react-ext/src/fetch-select/index.tsx":d,"/home/runner/work/antd-react-ext/antd-react-ext/src/fetch-select/fetch-select.tsx":c,"lodash-es":_,"@trionesdev/antd-react-ext":y,"/home/runner/work/antd-react-ext/antd-react-ext/src/ext-select/index.tsx":i,"/home/runner/work/antd-react-ext/antd-react-ext/src/ext-select/ExtSelect.tsx":u,"/home/runner/work/antd-react-ext/antd-react-ext/src/ext-form-field/index.tsx":m,"/home/runner/work/antd-react-ext/antd-react-ext/src/ext-form-field/ExtFormField.tsx":x},renderOpts:{compile:function(){var p=v()(s()().mark(function h(){var l,E=arguments;return s()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.e(250).then(e.bind(e,90250));case 2:return t.abrupt("return",(l=t.sent).default.apply(l,E));case 3:case"end":return t.stop()}},h)}));function f(){return p.apply(this,arguments)}return f}()}}}},58021:function(a,n,e){e.r(n),e.d(n,{texts:function(){return r}});const r=[{value:"\u83B7\u53D6\u8FDC\u7A0B\u6570\u636E\u7684Select,\u4F8B\u5982\u5217\u8868\u573A\u666F\u4E0B\u4F7F\u7528\uFF0C\u53EF\u4EE5\u901A\u8FC7\u884C\u6570\u636E\u4E2D\u7EC4\u88C5initialValueOption,\u6EE1\u8DB3Select\u5728\u4E0D\u8BF7\u6C42\u6570\u636E\u7684\u60C5\u51B5\u4E0B\uFF0C\u76F4\u63A5\u6E32\u67D3Select\u7684\u573A\u666F",paraId:0,tocIndex:0}]},72421:function(a,n){n.Z=`import React, {FC, isValidElement, memo, PropsWithChildren, useEffect, useState,} from 'react';

export type CommonExtFormFieldProps = {
    readonly?: boolean;
    valueRender?:
        | ((value?: any, options?: any) => React.ReactNode)
        | React.ReactNode;
    defaultRender?: React.ReactNode;
    emptyPlaceholder?:React.ReactNode
};

export type ExtFormFieldProps = CommonExtFormFieldProps & {
    value?: any;
    defaultValue?: any;
    onChange?: (...params:any) => void;
    options?: any | ((value?: any) => any[]);
    fieldRender?: (value?: any, options?: any) => React.ReactNode;
};
export const ExtFormField: FC<PropsWithChildren<ExtFormFieldProps>> = memo(
    ({
         children,
         value,
         defaultValue,
         onChange,
         options,
         readonly,
         valueRender,
         defaultRender,
         fieldRender,
         emptyPlaceholder = <div style={{color: '#6c6c6c'}}>--</div>
     }) => {

        const [internalValue, setInternalValue] = useState(value || defaultValue);
        const handleRender = () => {
            const valueOptions = typeof options === 'function' ? options(internalValue) : options;
            if (valueRender) {
                if (typeof valueRender === 'function') {
                    return valueRender(internalValue, valueOptions);
                } else {
                    return valueRender;
                }
            }
            if (fieldRender) {
                return fieldRender(internalValue, valueOptions);
            }
            return internalValue;
        };

        useEffect(() => {
            if (value === undefined) {
                return;
            }
            if (value !== internalValue) {
                setInternalValue(value);
            }
        }, [value]);

        if (readonly) {
            return <div style={{fontSize: 14}}>{handleRender() || defaultRender || emptyPlaceholder}</div>;
        }

        if (children){
            if(isValidElement(children)){
                return React.cloneElement(children  , {
                    ...children.props,
                    value: internalValue,
                    onChange: (...params: any) => {
                        if (params[0] && typeof params[0] === 'object' && 'nativeEvent' in params[0]) {
                            setInternalValue(params[0].target.value);
                        } else {
                            setInternalValue(params[0]);
                        }
                        if (children.props.onChange){
                            children.props.onChange(...params);
                        }
                        onChange?.(...params);
                    }
                })
            }
            return <>{children}</>
        }
        return ;

    },
);
`},94291:function(a,n){n.Z=`import {ExtFormField} from "./ExtFormField"

export type {CommonExtFormFieldProps, ExtFormFieldProps} from "./ExtFormField"
export default ExtFormField;
`},6721:function(a,n){n.Z=`import {Select, SelectProps} from 'antd';
import { includes } from 'lodash-es';
import React, {FC} from 'react';
import ExtFormField from '../ext-form-field';

export type ExtSelectProps = Omit<SelectProps, 'children'> & {
  readonly?: boolean;
  valueRender?:
    | ((value?: any, option?: any) => React.ReactNode)
    | React.ReactNode;
  defaultRender?: React.ReactNode;
};
export const ExtSelect: FC<ExtSelectProps> = ({
                                                  readonly = false,
                                                  valueRender,
                                                  defaultRender,
                                                  ...rest
                                              }) => {
    const valueField = rest.fieldNames?.value ?? 'value';
    const labelField = rest.fieldNames?.label ?? 'label';

    const handleValueOptions = (value: any) => {
        if (rest.mode === 'multiple' || rest.mode === 'tags') {
            return rest.options?.filter((option) => {
                return includes(value, option[valueField]);
            });
        } else {
            return rest.options?.find((option) => option[valueField] === value);
        }
    };

    const handleRender = (value: any, options: any) => {
        if (rest.mode === 'multiple' || rest.mode === 'tags') {
            return options?.map((option: any) => option[labelField]).join(', ');
        } else {
            return options?.[labelField];
        }
    };

    return (
        <ExtFormField
            value={rest.value}
            defaultValue={rest.defaultValue}
            readonly={readonly}
            valueRender={valueRender}
            defaultRender={defaultRender}
            options={handleValueOptions}
            fieldRender={(value, options) => {
                return handleRender(value, options);
            }}
        >
            <Select {...rest} />
        </ExtFormField>

    );
};
`},79458:function(a,n){n.Z=`import {ExtSelect,ExtSelectProps} from "./ExtSelect"

export type {ExtSelectProps}
export default ExtSelect`},44750:function(a,n){n.Z=`import React from 'react';
import FetchSelect from '../index';

export default () => {
  const [value, setValue] = React.useState(2);
  return (
    <FetchSelect
      fetchRequest={() => {
        return Promise.resolve([
          { id: 1, name: '\u5C0F\u660E' },
          { id: 2, name: '\u5C0F\u7EA2' },
        ]);
      }}
      fieldNames={{ label: 'name', value: 'id' }}
      initialValueOptions={[{ id: 2, name: '\u5C0F\u7EA2' }]}
      value={value}
      onChange={setValue}
    />
  );
};
`},8841:function(a,n){n.Z=`import { Button } from 'antd';
import React, { useState } from 'react';
import FetchSelect from '../index';

export default () => {
  const [value, setValue] = React.useState(3);
  const [initialValueOption, setInitialValueOption] = useState<any>();
  return (
    <div>
      <FetchSelect
        fetchRequest={() => {
          return Promise.resolve([
            { id: 1, name: '\u5C0F\u660E' },
            { id: 2, name: '\u5C0F\u7EA2' },
          ]);
        }}
        fieldNames={{ label: 'name', value: 'id' }}
        dropdownFetch={true}
        initialValueOptions={initialValueOption}
        fixedOptions={[{ id: 4, name: '\u5C0F\u84DD' }]}
        value={value}
        onChange={setValue}
      />
      <Button
        onClick={() => {
          setInitialValueOption([{ id: 3, name: '\u5C0F\u7EA2' }]);
        }}
      >
        \u8BBE\u7F6E\u521D\u59CB\u9009\u9879
      </Button>
    </div>
  );
};
`},75415:function(a,n){n.Z=`import {isEmpty, concat, debounce} from 'lodash-es';
import React, {FC, memo, useCallback, useEffect, useMemo, useState} from 'react';
import ExtSelect, {ExtSelectProps} from "../ext-select";
import {SessionStorageUtils} from "@trionesdev/antd-react-ext";


export type FetchSelectProps = {
    /**
     * @description \u521D\u59CB\u5316\u503C\u9009\u9879,\u7528\u4E8E\u5217\u8868\u7B49\u573A\u666F\u7684\u65F6\u5019\uFF0CSelect \u7EC4\u4EF6\u53EF\u4EE5\u5C55\u793A\uFF0C\u4E0D\u9700\u8981\u53BB\u8BF7\u6C42\u9009\u9879
     * @default
     */
    initialValueOptions?: any[];
    /**
     * @description \u56FA\u5B9A\u9009\u9879
     * @default
     */
    fixedOptions?: any[];
    /**
     * @description \u662F\u5426\u4E0B\u62C9\u7684\u65F6\u5019\u8BF7\u6C42\u6570\u636E
     * @default false
     */
    dropdownFetch?: boolean;
    /**
     * @description \u662F\u5426\u5141\u8BB8\u8BF7\u6C42
     * @default true
     */
    fetchEnable?: boolean;
    /**
     * @description \u662F\u5426\u6BCF\u6B21\u90FD\u8BF7\u6C42\u6570\u636E\uFF0C\u9ED8\u8BA4\u53EA\u8BF7\u6C42\u4E00\u6B21
     * @default false
     */
    fetchAlways?: boolean;
    fetchRequest?: (searchValue?: string) => Promise<any>;
    defaultRender?: React.ReactNode;
    cacheKey?: string;
    cacheExpire?: number;
} & Omit<ExtSelectProps, 'options' | 'onDropdownVisibleChange'>;
export const FetchSelect: FC<FetchSelectProps> = memo(({
                                                           initialValueOptions = [],
                                                           fixedOptions,
                                                           dropdownFetch = false,
                                                           fetchEnable = true,
                                                           fetchAlways = false,
                                                           fetchRequest,
                                                           defaultRender,
                                                           cacheKey,
                                                           cacheExpire = 0,
                                                           ...props
                                                       }) => {
    const [fetched, setFetched] = useState(false);
    const [fetchedOptions, setFetchedOptions] = useState([])

    const options = useMemo(() => {
        if (isEmpty(fetchedOptions)) {
            return concat([], fixedOptions || [], initialValueOptions || [])
        } else {
            return concat([], fixedOptions || [], fetchedOptions || [])
        }
    }, [fixedOptions, initialValueOptions, fetchedOptions])

    const handleQuery = useCallback(
        (searchValue?: string) => {
            const request =
                fetchRequest && fetchEnable
                    ? fetchRequest(searchValue)
                    : Promise.resolve([]);
            const data = SessionStorageUtils.getExpireItem(cacheKey, true);
            if (data) {
                setFetchedOptions(data || [])
                setFetched(true);
                return;
            }
            request
                .then((data: any) => {
                    setFetchedOptions(data || [])
                    SessionStorageUtils.setExpireItem(cacheKey, data, cacheExpire);
                })
                .finally(() => {
                    setFetched(true);
                });
        },
        [fetchRequest],
    );

    useEffect(() => {
        if (!dropdownFetch) {
            handleQuery();
        }
    }, []);

    return (
        <ExtSelect
            {...props}
            options={options}
            showSearch={{onSearch:(props.showSearch ? debounce(handleQuery, 500) : undefined)}}
            onOpenChange={(open: boolean) => {
                if (open && dropdownFetch && fetchEnable && (fetchAlways || !fetched)) {
                    handleQuery();
                }
                props.onOpenChange?.(open);
            }}
            defaultRender={defaultRender}
        />
    );
});
`},81867:function(a,n){n.Z=`import { FetchSelect, FetchSelectProps } from './fetch-select';

export type { FetchSelectProps };
export default FetchSelect;
`}}]);
